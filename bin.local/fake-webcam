#!/bin/sh

OFFSET=${1:-0}
DESKTOP_RES=$(xrandr | grep "*" | head -n1 | sed 's/^ *//' | cut -d" " -f1)
VIDEO_RES=800x600
FPS=20
IFACE=/dev/video${OFFSET}

if [ "$OFFSET" == "0" ]; then
  # ffmpeg -video_size ${VIDEO_RES} -f x11grab -r ${FPS} -s ${DESKTOP_RES} -i :0.0+0,0 -vcodec rawvideo -pix_fmt yuv420p -threads 0 -f v4l2 -vf "hflip" ${IFACE}
  while true; do
    ffmpeg -re -i ~/data/webcam_video.mp4 -vf "hflip" -f v4l2 ${IFACE}
  done
else
  ffmpeg -video_size ${VIDEO_RES} -f x11grab -r ${FPS} -s ${DESKTOP_RES} -i :0.0+0,0 -vcodec rawvideo -pix_fmt yuv420p -threads 0 -f v4l2 -vf "hflip" ${IFACE}
fi
