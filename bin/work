#!/bin/sh

path=$1
name=$(echo $path | grep -o '[^/]*$')
w=$(hyprctl activewindow -j | jq '.workspace.id')
chrome_profile="Default"
kitty_session="work-default"
editor_cmd="nvim"
editor_kitty_opts=""

# custom opts for specific projects
case $path in
  *iron-wallet/iron*)
    chrome_profile="Profile 1"
    kitty_session="iron"
    #editor_cmd="hx"
    ;;
esac


# kill everything in current workspace
clean_workspace() {
  # sends SIGINT to all windows in this workspace
  hyprctl clients -j |\
    jq ".[] | select(.workspace.id == 5) | .pid" |\
    xargs kill -s int -9

  hyprctl clients -j |\
    jq ".[] | select(.workspace.id == 2) | .pid" |\
    xargs kill -s int -9

  # # google-chrome needs to be closed differently
  # hyprctl clients -j |\
  #   jq ".[] | select(.class == \"google-chrome\") | select(.workspace.id == $w) | .address" |\
  #   xargs -n 1 -I {} hyprctl dispatch closewindow address:{}
}


# opens the default layout
# browser
# kitty
default() {
  browser="google-chrome-stable --profile-directory='${chrome_profile}'"
  term="kitty -d '$path' --session '~/.config/kitty/sessions/${kitty_session}.conf'"

  hyprctl dispatch exec "[tile; workspace 5 silent]" "$browser"
  hyprctl dispatch exec "[tile; workspace 2 silent]" "$term"
}

clean_workspace
default
