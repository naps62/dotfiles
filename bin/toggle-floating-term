#!/usr/bin/env zsh

float_term_name="floating_term"

_get_current_workspace() {
  i3-msg -t get_workspaces \
  | jq '.[] | select(.focused==true).name' \
  | cut -d"\"" -f2
}

_floating_term_id() {
  xdotool search --name "$float_term_name"
}

_current_workspace_floating_term_id() {
  current_workspace=`_get_current_workspace`
  xdotool search --desktop $((--current_workspace)) --name "$float_term_name"
}

if [ "`_floating_term_id`" -eq "" ]; then
  # floating term does not exist. starting one

  unset TMUX
  export NO_TMUX=1
  termite -t $float_term_name
  i3-msg "exec termite -t $float_term_name"

elif [ "`_current_workspace_floating_term_id`" -eq "" ]; then
  # floating term is not in the current workspace. moving it here

  i3-msg "[title=\"$float_term_name\"] scratchpad show" > /dev/null
  i3-msg "[title=\"$float_term_name\"] move position center" > /dev/null
else
  # floating term is in current workspace. hiding it

  i3-msg "[title=\"$float_term_name\"] move scratchpad" > /dev/null
fi
