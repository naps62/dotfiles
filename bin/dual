#!/usr/bin/env ruby

CONFIG_FILE = "~/.config/naps62-screen-setup"

RES = `xrandr | grep HDMI-2 -A 1 | tail -n 1 | awk '{ print $1 }'`.strip

RES="2560x1440"
FOURK = false #(RES == "3840x2160")

FLAGS = {
  clone: "--same-as",
  left: "--left-of",
  right: "--right-of",
  top: "--above"
}

def setup(id)
  `echo #{id} > #{CONFIG_FILE}`
`xrandr --output DP-2 --panning #{RES} --mode #{RES} #{FLAGS[id]} eDP-1`
end

def disable
  `rm #{CONFIG_FILE}`
  `xrandr --output DP-2 --off`
end

def toggle(id1, id2)
  current = `cat #{CONFIG_FILE}`.strip
  if current.empty?
    current = :clone
  end

  if current.to_sym == id1.to_sym
    setup(id2.to_sym)
  else
    setup(id1.to_sym)
  end
end

case ARGV[0]
when 'off' then disable
when 'clone' then setup(:clone)
when 'left' then setup(:left)
when 'right' then setup(:right)
when 'top' then setup(:top)
when 'toggle' then toggle(ARGV[1], ARGV[2])
else puts "Invalid options #{ARGV}"
end
